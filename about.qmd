

# What is the 'pmsims' project about?

* NHS services use prediction tools to [help make decisions about patient
  care.]{.hl} These tools rely on data to estimate what might happen in the
  future, like someone's risk of developing a health condition.

* However, if the tools are built using too little data, their predictions
  can be [inaccurate or unfair]{.hl}, particularly for people from
  underrepresented communities.

* We're building a free, easy-to-use tool to help researchers estimate [how
  much data they need]{.hl} to build accurate and fair prediction
  models---including newer approaches that use complex methods like machine
  learning.

* We're working with patients and the public to understand their views,
  ensure accessibility, and raise awareness of the risks associated with using
  too little information. Our goal is to improve the fairness and accuracy of
  prediction tools used in healthcare.

# How do prediction models work?

* Prediction modelling uses [statistics or computer algorithms]{.hl} to
  estimate what might happen in the future. More and more of these models are
  being created as larger datasets and better tools become available.

* For example, the [QRISK](https://www.qrisk.org/) tool estimates a
  person's risk of developing heart disease in the next 10 years. Doctors use
  it to decide who should be offered treatment to help prevent heart problems.

# Why sample size matters in prediction

* Many prediction models are developed using too little data. When this
  happens, the model can become too focused on the specific details of the
  sample it was trained on, rather than learning general patterns that apply
  more widely. This is known as overfitting. It means the model might appear
  accurate during development but make unreliable or unfair predictions in
  real-world settings.

* Small samples are especially problematic when making predictions for
  minoritised groups, as limited representation can lead to inaccurate and
  unfair predictions, potentially resulting in incorrect or even harmful
  treatment recommendations.

::: {=html}
<style>
  #sample-controls {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-bottom: 1.5rem;
    font-family: Lato, sans-serif;
  }
  #sample-controls label {
    font-size: 1rem;
    margin-bottom: 0.5rem;
  }
  #sampleSize {
    width: 80%;
    max-width: 500px;
  }
</style>

<div id="sample-controls">
  <label for="sampleSize">
    Sample size: <span id="sampleSizeValue">100</span>
  </label>
  <input type="range" id="sampleSize" min="100" max="5000" step="100" value="100" />
</div>

<canvas id="predictionChart" width="700" height="250"></canvas>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@1.4.0"></script>

<script>
  const ctx = document.getElementById('predictionChart').getContext('2d');
  const sampleSizeSlider = document.getElementById('sampleSize');
  const sampleSizeValue = document.getElementById('sampleSizeValue');
  const trueProbability = 0.6;

  function simulatePredictions(n, mean = trueProbability) {
    const std = 0.3 * Math.exp(-n / 1000);
    return Array.from({ length: 50 }, () => {
      let val = mean + randn_bm() * std;
      return Math.min(1, Math.max(0, val));
    });
  }

  function randn_bm() {
    let u = 0, v = 0;
    while (u === 0) u = Math.random();
    while (v === 0) v = Math.random();
    return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
  }

  function stabilityComment(n) {
    if (n <= 500) {
      return "Low sample size produces highly unstable predictions — unreliable for individual prediction.";
    } else if (n <= 2000) {
      return "Moderate sample size — predictions are more stable but still variable.";
    } else {
      return "High sample size — predictions are stable and consistent.";
    }
  }

  const chart = new Chart(ctx, {
    type: 'scatter',
    data: {
      datasets: [{
        data: [],
        pointRadius: 4,
        backgroundColor: 'rgba(0, 123, 255, 0.7)',
      }]
    },
    options: {
      animation: false,
      plugins: {
        tooltip: { enabled: false },
        legend: { display: false },
        annotation: {
          annotations: {
            trueLine: {
              type: 'line',
              xMin: trueProbability,
              xMax: trueProbability,
              borderColor: 'rgba(200, 0, 0, 0.8)',
              borderWidth: 2
            },
            trueLabel: {
              type: 'label',
              xValue: trueProbability,
              yValue: 0.35,  // moved lower to avoid overlap
              backgroundColor: 'rgba(200, 0, 0, 0.8)',
              content: '0.6',
              color: 'white',
              font: {
                size: 12,
                family: 'Lato'
              },
              textAlign: 'center',
              enabled: true
            },
            comment: {
              type: 'label',
              xValue: 0.5,
              yValue: 0.95,
              backgroundColor: 'rgba(255, 255, 255, 0.9)',
              borderColor: 'rgba(0, 0, 0, 0.1)',
              borderWidth: 1,
              padding: 10,
              cornerRadius: 6,
              font: {
                size: 14,
                family: 'Lato',
                weight: 'normal'
              },
              content: stabilityComment(100),
              position: 'center',
              textAlign: 'center',
              display: true
            }
          }
        }
      },
      scales: {
        x: {
          min: 0,
          max: 1,
          title: {
            display: true,
            text: 'Predicted Probability',
            font: {
              size: 14,
              family: 'Lato'
            }
          },
          ticks: {
            font: {
              size: 13,
              family: 'Lato'
            }
          }
        },
        y: {
          min: 0,
          max: 1,
          display: false
        }
      }
    },
    plugins: [Chart.registry.getPlugin('annotation')]
  });

  function updateChart(n) {
    const data = simulatePredictions(n).map(x => ({
      x: x,
      y: 0.5 + (Math.random() - 0.5) * 0.05
    }));
    chart.data.datasets[0].data = data;
    chart.options.plugins.annotation.annotations.comment.content = stabilityComment(n);
    chart.update();
  }

  updateChart(100);

  sampleSizeSlider.addEventListener('input', () => {
    const n = parseInt(sampleSizeSlider.value);
    sampleSizeValue.textContent = n;
    updateChart(n);
  });
</script>
:::

# How will this project help?

* An essential first step in building a model is estimating how much data
  is needed.

* We're creating a simple, user-friendly tool that estimates the minimum
  amount of data needed for different types of prediction models. It does this
  by generating synthetic (artificial) data of different sizes and testing how
  well models perform with each one.

* This will help researchers decide how complex their model should
  be---and help prevent models being developed without enough data, which can
  lead to inaccurate or unfair predictions and wasted research effort.
